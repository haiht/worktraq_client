(function(e){function r(){var e;try{e=navigator.plugins["Shockwave Flash"];e=e.description}catch(t){try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(n){e="0.0"}}e=e.match(/\d+/g);return parseFloat(e[0]+"."+e[1])}function i(e,t,n){var r=typeof e.remotePath=="function"?e.remotePath():e.remotePath;var i=[];i.push("ax-file-path="+encodeURIComponent(r));i.push("ax-allow-ext="+encodeURIComponent(e.allowExt.join("|")));i.push("ax-file-name="+encodeURIComponent(t));i.push("ax-thumbHeight="+e.thumbHeight);i.push("ax-thumbWidth="+e.thumbWidth);i.push("ax-thumbPostfix="+encodeURIComponent(e.thumbPostfix));i.push("ax-thumbPath="+encodeURIComponent(e.thumbPath));i.push("ax-thumbFormat="+encodeURIComponent(e.thumbFormat));i.push("ax-maxFileSize="+encodeURIComponent(e.maxFileSize));i.push("ax-fileSize="+n);var s=typeof e.data=="function"?e.data():e.data;if(typeof s=="object"){for(var o in s){i.push(o+"="+encodeURIComponent(s[o]))}}else if(typeof s=="string"&&s!=""){i.push(s)}var u=e.url.indexOf("?")==-1?"?":"&";return e.url+u+i.join("&")}function s(e,t){var n=e.file;var r=e.byte;var o=e.name;var u=n.size;var a=t.chunkSize;var f=a+r;var l=u-f<=0;var c=n;var h=new XMLHttpRequest;var p=f/a;e.xhr=h;if(r==0)t.SLOTS++;if(a==0){c=n;l=true}else if(n.mozSlice){c=n.mozSlice(r,f)}else if(n.webkitSlice){c=n.webkitSlice(r,f)}else if(n.slice){c=n.slice(r,a)}else{c=n;l=true}h.upload.addEventListener("abort",function(e){t.SLOTS--},false);h.upload.addEventListener("progress",function(t){if(t.lengthComputable){var n=Math.round((t.loaded+p*a-a)*100/u);e.progress(n)}},false);h.upload.addEventListener("error",function(t){e.error(this.responseText,o)},false);h.onreadystatechange=function(){if(this.readyState==4&&this.status==200){try{var n=JSON.parse(this.responseText);if(r==0)e.name=n.name;if(l){t.SLOTS--;t.received=n.received;e.end(n.name,n.size,n.status,n.info,n.received)}else if(n.status=="error"){throw n.info}else{e.byte=f;s(e,t)}}catch(i){t.SLOTS--;e.error("error",i)}}};var d=i(t,o,u);h.open("POST",d+"&ax-start-byte="+r+"&isLast="+l,t.async);h.setRequestHeader("Cache-Control","no-cache");h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.setRequestHeader("Content-Type","application/octet-stream");h.send(c)}function o(){return"AJAX-----------------------"+(new Date).getTime()}function u(t,n,r,i){if(n.type.match(/image.*/)&&(r=="jpg"||r=="gif"||r=="png")&&typeof FileReader!=="undefined"){var s=t.css("background","none").children("img:first");var o=new FileReader;o.onload=function(t){s.css("cursor","pointer").attr("src",t.target.result).click(function(){var r=new Image;r.onload=function(){var r=Math.min(e(window).width()/this.width,(e(window).height()-100)/this.height);var i=r<1?this.width*r:this.width;var s=r<1?this.height*r:this.height;e("#ax-box").html('<img width="'+i+'" height="'+s+'" src="'+t.target.result+'" /><a>Close</a><span>'+n.name+"</span>").fadeIn(100).css({top:e(window).scrollTop()-20+(e(window).height()-s)/2+"px",height:s+20+"px",width:i+"px",left:(e(window).width()-i)/2});e("#ax-box").find("a").css("cursor","pointer").click(function(t){t.preventDefault();e("#ax-box-shadow, #ax-box").fadeOut(100)});e("#ax-box-shadow").css("height",e(document).height()).fadeIn(100)};r.src=t.target.result})};o.readAsDataURL(n)}else{t.children("img:first").remove();t.addClass("ax-filetype-"+r)}}function a(e){setTimeout(function(){var t=true;for(var n=0;n<e.length;n++){if(e[n].xhr===null&&e[n].status!="uploaded"&&e[n].status!="error"){t=false;e[n].sns()}}if(!t)a(e)},300)}function f(e,t){switch(e){case"gb":t=t/(1024*1024*1024);break;case"mb":t=t/(1024*1024);break;case"kb":t=t/1024;break}return Math.round(t*100)/100+" "+e}function l(t,r,i){var s=r.name;var o=f(i.showSize,r.size);var a=e("<li />").appendTo(t).attr("title",s);var l=e('<a class="ax-prev-container" />').appendTo(a);var c=e('<img class="ax-preview" src="" alt="Preview" />').appendTo(l);var h=e('<div class="ax-details" />').appendTo(a);var p=e('<div class="ax-file-name">'+s+"</div>").appendTo(h);if(i.editFilename){p.dblclick(function(t){t.stopPropagation();var n=s.substr(0,s.lastIndexOf("."));e(this).html('<input type="text" value="'+n+'" />.'+r.ext)}).bind("blur",function(t){t.stopPropagation();var i=e(this).children("input").val();if(typeof i!="undefined"){var s=i.replace(/[|&;$%@"<>()+,]/g,"");var o=s+"."+r.ext;e(this).html(o);r.name=o;if(!n&&r.xhr){r.xhr.children('input[name="ax-file-name"]').val(o)}}})}var d=e('<div class="ax-file-size">'+o+"</div>").appendTo(h);var v=e('<div class="ax-progress" />').appendTo(a);var m=e('<div class="ax-progress-bar" />').appendTo(v);var g=e('<div class="ax-progress-info">0%</div>').appendTo(v);var y=e('<div class="ax-toolbar" />').appendTo(a);var b=e('<a title="Start upload" class="ax-upload ax-button" />').click(function(){if(i.enable)r.sns()}).appendTo(y).append('<span class="ax-upload-icon ax-icon"></span>');var w=e('<a title="Remove file" class="ax-remove ax-button" />').click(function(){if(i.enable)r.remove()}).appendTo(y).append('<span class="ax-clear-icon ax-icon"></span>');u(l,r.file,r.ext,i);return{pBar:m,pNum:g,upload:b,remove:w,nameC:p,li:a,sizeC:d}}function c(e,t,n){var r=n.FILES;var i=l(e,t,n);var o=i.upload;var u=i.remove;t.tools=i;t.end=function(e,t,i,s,o){n.UPLOADED++;n.received=o;this.name=e;this.received=o;this.status=i;this.info=s;this.xhr=null;this.byte=0;this.tools.nameC.html(e);this.tools.li.attr("title",e);this.tools.pNum.html("100%");this.tools.pBar.css("width","100%");this.tools.upload.removeClass("ax-abort");alert("1: "+o);n.success(e,o);if(r.length==n.UPLOADED){var u=[];n.UPLOADED=0;for(var a=0;a<r.length;a++)u.push(r[a].name);n.finish(u);n.internalFinish(u)}};t.progress=function(e){this.tools.pNum.html(e+"%");this.tools.pBar.css("width",e+"%")};t.error=function(e,t){this.xhr=null;this.byte=0;this.status=e;this.info=t;this.tools.pNum.html(t);this.tools.pBar.css("width","0%");this.tools.upload.removeClass("ax-abort");n.error(t,this.name)};t.sns=function(e){if(this.xhr!==null){this.xhr.abort();this.xhr=null;this.byte=0;this.tools.upload.removeClass("ax-abort")}else if(n.SLOTS<n.maxConnections){this.tools.pNum.html("0%");this.tools.pBar.css("width","0%");this.tools.upload.addClass("ax-abort");s(this,n)}};t.remove=function(){r.splice(this.pos,1);if(this.xhr)this.xhr.abort();this.file=null;this.xhr=null;for(var e=0;e<r.length;e++)r[e].pos=e;this.tools.li.remove()}}function h(t,n,r){var s=r.FILES;var o=l(t,n,r);var u=o.upload;var a=o.remove;var c=document.getElementById("ax-main-frame");var h=i(r,"",0);var d=e('<form action="'+h+'" method="post" target="ax-main-frame" encType="multipart/form-data" />').hide().appendTo(o.li);d.append('<input type="hidden" value="'+encodeURIComponent(n.name)+'" name="ax-file-name" />');e(n.file).appendTo(d);n.xhr=d;n.tools=o;n.end=function(e,t,n,i,o){r.UPLOADED++;r.received=o;this.name=e;this.received=o;this.status=n;this.info=i;this.byte=0;this.size=t;this.tools.nameC.html(e);this.tools.sizeC.html(f(r.showSize,t));this.tools.li.attr("title",e);if(n=="error"){this.tools.pNum.html(i);this.tools.pBar.css("width","0%")}else{this.tools.pNum.html("100%");this.tools.pBar.css("width","100%")}this.tools.upload.removeClass("ax-abort");alert("2: "+o);r.success(e,o);if(s.length==r.UPLOADED){var u=[];r.UPLOADED=0;for(var a=0;a<s.length;a++)u.push(s[a].name);r.finish(u);r.internalFinish(u)}};n.progress=function(e){this.tools.pNum.html(e+"%");this.tools.pBar.css("width",e+"%")};n.sns=function(){if(u.hasClass("ax-abort")){try{c.contentWindow.document.execCommand("Stop")}catch(e){c.contentWindow.stop()}u.removeClass("ax-abort")}else{this.tools.pNum.html(0+"%");this.tools.pBar.css("width",0+"%");this.tools.upload.addClass("ax-abort");p(this,false,s)}};n.remove=function(){s.splice(this.pos,1);try{c.contentWindow.document.execCommand("Stop")}catch(t){c.contentWindow.stop()}e(this.file).remove();this.file=null;for(var n=0;n<s.length;n++)s[n].pos=n;this.tools.li.remove()}}function p(t,n,r){if(r.length>0){e("#ax-main-frame").unbind("load").bind("load",function(){var i;if(this.contentDocument){i=this.contentDocument}else if(this.contentWindow){i=this.contentWindow.document}var s=e.parseJSON(i.body.innerHTML);t.progress(100);t.end(s.name,s.size,s.status,s.info,s.received);if(n&&r[t.pos+1]){p(r[t.pos+1],true,r)}});t.xhr.submit()}}function d(t,r,i){var s=i.FILES;for(var o=0;o<t.length;o++){var u,a,f,l=s.length;if(n){a=t[o].name;f=t[o].size}else{a=t[o].value.replace(/^.*\\/,"");f=0}u=a.split(".").pop().toLowerCase();if(s.length<i.maxFiles&&(e.inArray(u,i.allowExt)>=0||i.allowExt.length==0)){var p={pos:l,"byte":0,sns:function(){},error:function(){},end:function(){},progress:function(){},file:t[o],status:"ok",name:a,size:f,received:0,xhr:null,info:"",ext:u};s.push(p);if(n)c(r,p,i);else h(r,p,i)}}}function v(e){n?a(e):p(e[0],true,e)}function m(e){if(!e.enable)return;while(e.FILES.length>0)e.FILES[0].remove()}var t=document.createElement("input");t.type="file";var n="multiple"in t&&typeof File!="undefined"&&typeof (new XMLHttpRequest).upload!="undefined";t=null;var g={remotePath:"js/",url:"upload.php",flashUrl:"upload.swf",data:"",async:true,maxFiles:9999,allowExt:[],showSize:"Mb",success:function(e,t){},finish:function(e){},error:function(e,t){},enable:true,chunkSize:1024*1024,maxConnections:3,received:0,dropColor:"red",dropArea:"self",autoStart:false,thumbHeight:0,thumbWidth:0,thumbPostfix:"_thumb",thumbPath:"",thumbFormat:"",maxFileSize:"10M",form:null,editFilename:false,sortable:false,selectText1:"Select Files or Drag&Drop Files",selectText2:"Select Files"};var y={init:function(t){return this.each(function(){function y(){var e=f.clone(true).appendTo(a);f.remove();f=e}var r=e(this).html("");if(r.hasClass("ax-uploader")){return}r.addClass("ax-uploader").data("author","http://www.albanx.com/");var i="ax_uploader_"+Math.round(Math.random()*1e3);while(e(i).length>0){i="ax_uploader_"+Math.round(Math.random()*1e3)}this.id=i;var s=e.extend({},g,t);s.FILES=[];s.UPLOADED=0;s.SLOTS=0;s.internalFinish=function(){};s.received=0;var o=null;if(e(s.form).length>0){o=e(s.form)}else if(s.form=="parent"){o=r.parents("form:first")}if(typeof o!="undefined"&&o!=null){o.bind("submit.ax",function(){if(s.FILES.length>0){v(s.FILES);return false}});s.internalFinish=function(e){if(o!=null){var t=typeof s.remotePath=="function"?s.remotePath():s.remotePath;for(var n=0;n<e.length;n++){var r=t+e[n];o.append('<input name="ax-uploaded-files[]" type="hidden" value="'+r+'" />')}o.unbind("submit.ax");var i=o.find('[name="submit"]');if(i.length>0)i.trigger("click");else o.submit()}}}s.showSize=s.showSize.toLowerCase();s.allowExt=e.map(s.allowExt,function(e,t){return e.toLowerCase()});r.data("settings",s);if(e("#ax-box").length==0)e('<div id="ax-box"/>').appendTo("body");if(e("#ax-box-shadow").length==0)e('<div id="ax-box-shadow"/>').appendTo("body");if(e("#ax-main-frame").length==0)e('<iframe name="ax-main-frame" id="ax-main-frame" />').hide().appendTo("body");var u=e("<fieldset />").append('<legend class="ax-legend">'+s.selectText2+"</legend>").appendTo(r);var a=e('<a class="ax-browse-c ax-button" title="Add Files" />').appendTo(u);a.append('<span class="ax-plus-icon ax-icon"></span> <span>Add Files</span>');var f=e('<input type="file" class="ax-browse" name="ax-files[]" />').attr("multiple",n).appendTo(a);var l=e('<a class="ax-upload-all ax-button" title="Upload all files" />').appendTo(u);l.append('<span class="ax-upload-icon ax-icon"></span> <span>Start upload</span>');var c=e('<a class="ax-clear ax-button" title="Clear all" />').appendTo(u);c.append('<span class="ax-clear-icon ax-icon"></span> <span>Remove all</span>');var h=e('<ul class="ax-file-list" />').appendTo(u);var p=e('<span class="ax-net-info"></span>').appendTo(r);f.bind("change",function(){if(!s.enable)return;if(n){d(this.files,h,s);if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1);y()}else{d([this],h,s);e(this).clone(true).val("").appendTo(a);e(this).hide()}if(s.autoStart){v(s.FILES)}});l.bind("click",function(){if(!s.enable)return;v(s.FILES);return false});c.bind("click",function(){m(s);return false});if(n){var b=s.dropArea=="self"?this:e(s.dropArea).get(0);if(s.dropArea=="self"){u.find(".ax-legend").html(s.selectText1)}b.addEventListener("dragenter",function(e){e.stopPropagation();e.preventDefault()},false);b.addEventListener("dragover",function(t){if(!s.enable)return;t.stopPropagation();t.preventDefault();e(this).css("background-color",s.dropColor)},false);b.addEventListener("dragleave",function(t){t.stopPropagation();t.preventDefault();e(this).css("background-color","")},false);b.addEventListener("drop",function(t){if(!s.enable)return;t.stopPropagation();t.preventDefault();d(t.dataTransfer.files,h,s);e(this).css("background-color","");if(s.autoStart){v(s.FILES)}},false)}r.bind("click.ax",function(t){if(t.target.nodeName!="INPUT")e(".ax-file-name").trigger("blur")});e(document).unbind(".ax").bind("keyup.ax",function(t){if(t.keyCode==27){e("#ax-box-shadow, #ax-box").fadeOut(100)}});if(!s.enable){r.ajaxupload("disable")}})},enable:function(){return this.each(function(){var t=e(this);var n=t.data("settings");n.enable=true;t.data("settings",n);e(this).removeClass("ax-disabled").find("input").attr("disabled",false)})},disable:function(){return this.each(function(){var t=e(this);var n=t.data("settings");n.enable=false;t.data("settings",n);e(this).addClass("ax-disabled").find("input").attr("disabled",true)})},start:function(){return this.each(function(){var t=e(this).data("settings");v(t.FILES)})},clear:function(){return this.each(function(){var t=e(this).data("settings");m(t)})},destroy:function(){return this.each(function(){var t=e(this).data("settings");m(t);e(this).removeData("settings").html("")})},option:function(t,n){return this.each(function(){var r=e(this);var i=r.data("settings");if(n!=null&&n!=undefined){i[t]=n;r.data("settings",i);if(!i.enable){r.ajaxupload("disable")}else{r.ajaxupload("enable")}}else{return i[t]}})}};e.fn.ajaxupload=function(t,n){if(y[t]){return y[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return y.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.ajaxupload")}}})(jQuery)